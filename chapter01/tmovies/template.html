<html>
<head>

<!--
Generated by:
https://github.com/pythonbyexample/PBE/tree/master/code/jstmovie.py
 -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js" type="text/javascript"></script>
<script src="jquery-1.8.3.min.js" type="text/javascript"></script>
<script>

// Test commands
var commands = [];
commands.push( ["text", ['']] )

for (var x = 1; x<40; x++) {
    commands.push( ["type", ''] )
    commands.push( ["text", ["  line line line line line line line line line line line line line "+x, '']] )
    commands.push( ["pause", '1'] )
    commands.push( ["text", [" line "+x, '', '']] )
}

var commands = %COMMANDS%;

(function($, name) {
/* jQuery typewriter plugin
    2012-11-15
    https://github.com/bergus */
    $[name+"Defaults"] = {
        framerate: 2500/60,
        group: /.{0,2}/g // 2: Number of chars per frame
    };
    $.fn[name] = function(options, callback) {
        if (typeof options != 'object') callback=options, options={};

        return this.each(function() {
            var el = $(this),
                conf = $.extend({}, $[name+"Defaults"], options);
            el.queue("fx", function(next) {
                animateNode(this, conf, typeof callback == 'function'
                  ? function() { callback.call(el[0]); next(); }
                  : next
                );
                el.show();
            });
        });
    };
    function chunk(text, conf) {
        // splitting the text into parts (http://stackoverflow.com/a/11657799/1048572)
        return text.match(conf.group);
    }
    function timeout(callback, conf) {
        // set up the timeout
        // want to randomize? Have a look at http://jsfiddle.net/pZb8W/2/ for possible implementation
        setTimeout(callback, conf.framerate);
    }
    function animateNode(element, conf, callback) {
        var pieces = [];
        if (element.nodeType==1 && element.hasChildNodes()) {
            while (element.hasChildNodes())
                pieces.push(element.removeChild(element.firstChild));
            (function childStep() {
                if (pieces.length) {
                    var piece = pieces.shift();
                    animateNode(piece, conf, childStep);
                    element.appendChild(piece);
                } else
                    callback();
            })();
        } else if (element.nodeType==3) {
            pieces = chunk(element.data, conf);
            element.data = "";
            (function addText(){
                element.data += pieces.shift();
                timeout(pieces.length ? addText : callback, conf);
            })();
        } else // empty or special (comment etc) node
            timeout(callback, conf);
    }

})(jQuery, "typewriter");


var $pause       = false;
var $type_effect = false;
var $index       = 0;
var $scrolldist  = 0;
var start_scroll = 15;

$(document).ready( function() {
    process_commands();
});


function process_commands() {
    if ($pause || $index >= commands.length) return;

    var command  = commands[$index][0];
    var arg      = commands[$index][1];
    var textarea = $("div#main");
    var timeout  = 500;
    var speed    = $("input#speed").val();

    if (!speed) speed = 1;
    speed = parseInt(speed);

    //if (speed < 1 || speed > 5) speed = 1;
    speed = 1 + (speed-1) / 4;
    // final max speed should be 2 at most.
    //$("span#progress").text($index + '/' + commands.length);
    $("span#progress").text(parseInt($index / commands.length * 100.0) + '%');
    $index++;

    if (command == "text") {
        var line = arg;
        if ($index >= start_scroll) {
            $scrolldist += 40;
            textarea.scrollTop($scrolldist);
        }

        eline = $("<span>" + line + "&nbsp;</span><br />").hide().appendTo(textarea);
        if ($type_effect) {
            eline.typewriter();
            timeout += (line.length * 40) / speed;

            // typewriter needs this to be shown fully
            $scrolldist += 40;
            textarea.scrollTop($scrolldist);
        } else {
            eline.show();
        }

        if (line.replace(/ /g, '') == '') $type_effect = false;

    } else if (command == "pause") {
        timeout = parseInt(arg, 10) * 1000;

    } else if (command == "type") {
        $type_effect = true;
    }

    if ($pause) {
        // avoid skipping scheduled command
        $index--;
        if ($index < 0) $index = 0;
    } else {
        setTimeout(process_commands, timeout / speed);
        //setTimeout(process_commands, timeout);
    }
}


function toggle_pause() {
    $("button").text($pause ? "Pause" : "Unpause")
    $pause = $pause ? false : true;
    if (!$pause) process_commands();
}

</script>
<style>
    * {
        font-family: Verdana, Arial, Sans-Serif;
        font-size: 14px;
    }

    div#main {
        background: #e5e5e5; none repeat scroll 0 0;
        border:3px solid #666666;
        margin:5px;
        padding:5px;
        position:relative;
        width:900px;
        height:550px;
        overflow:auto;
    }

    button { margin-left: 100px; }
</style>
      <!-- p { margin:10px;padding:5px;border:2px solid #666; } -->
</head>

<body>
    <button onClick="toggle_pause()">Pause</button>
    Speed (1-5): <input id="speed" type="text" name="speed" value="1" size="3" />
    <span id="progress"></span>

    <div id="main"></div>
</body>
</html>
