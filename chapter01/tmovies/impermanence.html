<html>
<head>
<!-- <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js" type="text/javascript"></script> -->
<script src="jquery-1.8.3.min.js" type="text/javascript"></script>
<style>
    * {
        font-family: Verdana, Arial, Sans-Serif;
        font-size: 14px;
    }

    div#main {
        background:#eee none repeat scroll 0 0;
        border:3px solid #666666;
        margin:5px;
        padding:5px;
        position:relative;
        width:900px;
        height:550px;
        overflow:auto;
    }

    button#start { margin-left: 100px; }
</style>
</head>

<body>
    <button id="start" onClick="start()">Start</button>
    <button id="pause" onClick="toggle_pause()">Pause</button>
    Clear (sec) <input id="clear" type="text" name="clear" value="2" size="3" />
    <span id="progress"></span>
    <br />
    <textarea cols="120" rows="10"></textarea>
<script>

String.prototype.repeat = function(times) {
    return (new Array(times + 1)).join(this);
}


function start() {
    $("span#progress").text("");
    $last = new Date() / 1000;
    setTimeout(clear, 1000);
}

function get_clear()
    { return parseInt( $("input#clear").val() ) + 1; }

function clear() {
    var now = new Date() / 1000;
    var elapsed = Math.round(now - $last);

    if (elapsed >= get_clear()) {
        $("textarea").val('');
    }
    else {
        setTimeout(clear, 1000);
        $("span#progress").text('.'.repeat(elapsed));
    }
}

$("textarea").keypress(function(event) {
    start();
});


function toggle_pause() {
    $("button#pause").text($pause ? "Pause" : "Unpause")
    $pause = $pause ? false : true;
    if (!$pause) process_commands();
}

function Xstart() {
    //var text = $("textarea#input").text().split('\n');
    commands.length = 0;
    var text = $("textarea#input").val().split('\n');

    $.each(text, function(i, line) {
        var txt = lineBreaks(line, 90).split('\n');
        $.each(txt, function(i, line) {
            commands.push( ["text", line] );
            commands.push( ["pause", '1'] );
        });
    });

    var blank = ["text", ' ']
    var d = Array(30).join('-');
    commands.push(blank, blank, blank);
    commands.push( ["text", d + " THE END " + d]);
    commands.push(blank, blank, blank);
    process_commands();
}

</script>
</body>
</html>
