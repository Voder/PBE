<html>
<head>
<!-- <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js" type="text/javascript"></script> -->
<script src="jquery-1.8.3.min.js" type="text/javascript"></script>
<script>

// var commands = %(commands)s;
var commands = [];
commands.push( ["text", ['']] )

for (var x = 1; x<40; x++) {
    commands.push( ["type", ''] )
    commands.push( ["text", ["  line line line line line line line line line line line line line "+x, '']] )
    commands.push( ["pause", '1'] )
    commands.push( ["text", [" line "+x, '', '']] )
}

window.pause     = false;
var $index       = 0;
var $type_effect = false;
var $scrolldist  = 0;
var start_scroll = 22;

$(document).ready( function() {

    $.fn.teletype = function(opts) {
        var $this = this,
            defaults = {
                animDelay: 50
            },
            settings = $.extend(defaults, opts);

        $.each(settings.text.split(''), function(i, letter) {
            setTimeout(function(){
                $this.html($this.html() + letter);
            }, settings.animDelay * i);
        });
    };

    process_commands();

});

function process_commands() {
        if (window.pause || $index >= commands.length) return;

        var command  = commands[$index][0];
        var arg      = commands[$index][1];
        var textarea = $("div#main");
        var timeout  = 500;
        $index++;

        if (command == "text") {
            for (var x = 0; x<arg.length; x++) {
                var line = arg[x];
                if ($index >= start_scroll) {
                    $scrolldist += 30;
                    textarea.scrollTop($scrolldist);
                }

                if ($type_effect) {
                    eline = $("<p>" + line + "</p>").hide().appendTo(textarea);
                    console.log(eline);
                    eline.fadeIn(1000);
                    //eline.slideDown("slow");
                } else {
                    textarea.append("<p>" + line + "</p>");
                }

                if (line.replace(/ /g, '') == '') $type_effect = false;

            }
        } else if (command == "pause") {
            timeout = parseInt(arg, 10) * 1000;

        } else if (command == "type") {
            $type_effect = true;
        }

        if (window.pause) {
            // avoid skipping scheduled command
            $index--;
            if ($index<0) $index = 0;
        } else {
            setTimeout(process_commands, timeout);
        }
    }


function toggle_pause() {
    $("button").text(window.pause ? "Pause" : "Unpause")
    window.pause = window.pause ? false : true;
    if (!window.pause) process_commands();
}

</script>
<style>
    * {
        font-family: Verdana, Arial, Sans-Serif;
        font-size: 14px;
    }

    div#main {
        background:#CCCCCC none repeat scroll 0 0;
        border:3px solid #666666;
        margin:5px;
        padding:5px;
        position:relative;
        width:900px;
        height:550px;
        overflow:auto;
    }
</style>
      <!-- p { margin:10px;padding:5px;border:2px solid #666; } -->
</head>

<body>
    <h3>Python List Comprehensions</h3>

    <button onClick="toggle_pause()">Pause</button>

    <div id="main"></div>
</body>
</html>
