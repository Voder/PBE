<html>
<head>

<!--
Generated by:
https://github.com/pythonbyexample/PBE/tree/master/code/jstmovie.py
 -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js" type="text/javascript"></script>
<script src="jquery-1.8.3.min.js" type="text/javascript"></script>
<script>

// Test commands
var commands = [];
commands.push( ["text", ['']] )

for (var x = 1; x<40; x++) {
    commands.push( ["type", ''] )
    commands.push( ["text", ["  line line line line line line line line line line line line line "+x, '']] )
    commands.push( ["pause", '1'] )
    commands.push( ["text", [" line "+x, '', '']] )
}

var commands = [
    [
        "text",
        " "
    ],
    [
        "text",
        " "
    ],
    [
        "text",
        " List comprehensions are easy"
    ],
    [
        "text",
        " "
    ],
    [
        "text",
        " "
    ],
    [
        "pause",
        "2"
    ],
    [
        "text",
        " "
    ],
    [
        "text",
        " List comprehensions let you process and filter lists with minimal effort"
    ],
    [
        "text",
        " "
    ],
    [
        "text",
        " "
    ],
    [
        "pause",
        "5"
    ],
    [
        "text",
        " "
    ],
    [
        "text",
        " Let's make a small list:"
    ],
    [
        "text",
        " "
    ],
    [
        "type",
        null
    ],
    [
        "text",
        " &nbsp;&nbsp;&nbsp;&nbsp;>>> lst = range(20)"
    ],
    [
        "text",
        " "
    ],
    [
        "text",
        " "
    ],
    [
        "pause",
        "2"
    ],
    [
        "text",
        " "
    ],
    [
        "text",
        " Now let's make a simple list comprehension that does not do ANYTHING:"
    ],
    [
        "text",
        " "
    ],
    [
        "type",
        null
    ],
    [
        "text",
        " &nbsp;&nbsp;&nbsp;&nbsp;>>> [i for i in lst]"
    ],
    [
        "text",
        " &nbsp;&nbsp;&nbsp;&nbsp;[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19]"
    ],
    [
        "text",
        " "
    ],
    [
        "text",
        " "
    ],
    [
        "pause",
        "3"
    ],
    [
        "text",
        " "
    ],
    [
        "text",
        " "
    ],
    [
        "text",
        " "
    ],
    [
        "text",
        " "
    ],
    [
        "text",
        " This should give you a good idea of what elements you can have in a list"
    ],
    [
        "text",
        " comprehension and where they are. In the example above, both elements are"
    ],
    [
        "text",
        " absent, but you can have a processing element and a filter element:"
    ],
    [
        "text",
        " "
    ],
    [
        "text",
        " &nbsp;&nbsp;&nbsp;&nbsp;[process(i) for i in lst if filter(i)]"
    ],
    [
        "text",
        " "
    ],
    [
        "text",
        " (don't run this command, it just shows you the placement of process and"
    ],
    [
        "text",
        " filter)"
    ],
    [
        "text",
        " "
    ],
    [
        "text",
        " "
    ],
    [
        "pause",
        "12"
    ],
    [
        "text",
        " "
    ],
    [
        "text",
        " "
    ],
    [
        "text",
        " "
    ],
    [
        "text",
        " "
    ],
    [
        "text",
        " "
    ],
    [
        "text",
        " Let's look at what you can do by adding a filter:"
    ],
    [
        "text",
        " "
    ],
    [
        "type",
        null
    ],
    [
        "text",
        " &nbsp;&nbsp;&nbsp;&nbsp;>>> [i for i in lst if i>5]"
    ],
    [
        "text",
        " &nbsp;&nbsp;&nbsp;&nbsp;[6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19]"
    ],
    [
        "text",
        " "
    ],
    [
        "text",
        " "
    ],
    [
        "pause",
        "3"
    ],
    [
        "text",
        " "
    ],
    [
        "text",
        " A bit more complex filter:"
    ],
    [
        "text",
        " "
    ],
    [
        "type",
        null
    ],
    [
        "text",
        " &nbsp;&nbsp;&nbsp;&nbsp;>>> [i for i in lst if i<5 or i>15]"
    ],
    [
        "text",
        " &nbsp;&nbsp;&nbsp;&nbsp;[0, 1, 2, 3, 4, 16, 17, 18, 19]"
    ],
    [
        "text",
        " "
    ],
    [
        "text",
        " "
    ],
    [
        "pause",
        "3"
    ],
    [
        "text",
        " "
    ],
    [
        "text",
        " "
    ],
    [
        "text",
        " "
    ],
    [
        "text",
        " "
    ],
    [
        "text",
        " "
    ],
    [
        "text",
        " Enough with filters! Let's look at the processing part:"
    ],
    [
        "text",
        " "
    ],
    [
        "type",
        null
    ],
    [
        "text",
        " &nbsp;&nbsp;&nbsp;&nbsp;>>> [i*3 for i in lst]"
    ],
    [
        "text",
        " &nbsp;&nbsp;&nbsp;&nbsp;[0, 3, 6, 9, 12, 15, 18, 21, 24, 27, 30, 33, 36, 39, 42, 45, 48, 51, 54, 57]"
    ],
    [
        "text",
        " "
    ],
    [
        "text",
        " "
    ],
    [
        "pause",
        "3"
    ],
    [
        "text",
        " "
    ],
    [
        "text",
        " Naturally, you can also create new types in your comprehension, like"
    ],
    [
        "text",
        " strings:"
    ],
    [
        "text",
        " "
    ],
    [
        "type",
        null
    ],
    [
        "text",
        " &nbsp;&nbsp;&nbsp;&nbsp;>>> ['#'+str(i) for i in lst]"
    ],
    [
        "text",
        " &nbsp;&nbsp;&nbsp;&nbsp;['#0', '#1', '#2', '#3', '#4', '#5', '#6', '#7', '#8', '#9', '#10', '#11', '#12', '#13',"
    ],
    [
        "text",
        " &nbsp;&nbsp;&nbsp;&nbsp;'#14', '#15', '#16', '#17', '#18', '#19']"
    ],
    [
        "text",
        " "
    ],
    [
        "text",
        " "
    ],
    [
        "pause",
        "3"
    ],
    [
        "text",
        " "
    ],
    [
        "text",
        " .. or tuples:"
    ],
    [
        "text",
        " "
    ],
    [
        "type",
        null
    ],
    [
        "text",
        " &nbsp;&nbsp;&nbsp;&nbsp;>>> [(i, i*i) for i in lst]"
    ],
    [
        "text",
        " &nbsp;&nbsp;&nbsp;&nbsp;[(0, 0), (1, 1), (2, 4), (3, 9), (4, 16), (5, 25), (6, 36), (7, 49), (8, 64), (9, 81), (10,"
    ],
    [
        "text",
        " &nbsp;&nbsp;&nbsp;&nbsp;100), (11, 121), (12, 144), (13, 169), (14, 196), (15, 225), (16, 256), (17, 289), (18, 324),"
    ],
    [
        "text",
        " &nbsp;&nbsp;&nbsp;&nbsp;(19, 361)]"
    ],
    [
        "text",
        " "
    ],
    [
        "text",
        " "
    ],
    [
        "pause",
        "2"
    ],
    [
        "text",
        " "
    ],
    [
        "text",
        " "
    ],
    [
        "text",
        " "
    ],
    [
        "text",
        " "
    ],
    [
        "text",
        " "
    ],
    [
        "text",
        " Often you might want to combine processing and a filter in the same"
    ],
    [
        "text",
        " comprehension:"
    ],
    [
        "text",
        " "
    ],
    [
        "type",
        null
    ],
    [
        "text",
        " &nbsp;&nbsp;&nbsp;&nbsp;>>> [(i+1, i+2, i+3) for i in lst if i>10]"
    ],
    [
        "text",
        " &nbsp;&nbsp;&nbsp;&nbsp;[(12, 13, 14), (13, 14, 15), (14, 15, 16), (15, 16, 17), (16, 17, 18), (17, 18, 19), (18, 19,"
    ],
    [
        "text",
        " &nbsp;&nbsp;&nbsp;&nbsp;20), (19, 20, 21), (20, 21, 22)]"
    ],
    [
        "text",
        " "
    ],
    [
        "text",
        " "
    ],
    [
        "pause",
        "3"
    ],
    [
        "text",
        " "
    ],
    [
        "text",
        " "
    ],
    [
        "text",
        " "
    ],
    [
        "text",
        " "
    ],
    [
        "text",
        " If either filter or processing logic get cumbersome, you can tuck them away"
    ],
    [
        "text",
        " in functions:"
    ],
    [
        "text",
        " "
    ],
    [
        "type",
        null
    ],
    [
        "text",
        " &nbsp;&nbsp;&nbsp;&nbsp;>>> def over_ten(i): return bool(i>10)"
    ],
    [
        "type",
        null
    ],
    [
        "text",
        " &nbsp;&nbsp;&nbsp;&nbsp;>>> def mktuple(i): return i+1, i+2, i+3"
    ],
    [
        "text",
        " "
    ],
    [
        "text",
        " "
    ],
    [
        "pause",
        "3"
    ],
    [
        "text",
        " "
    ],
    [
        "text",
        " The result is the same, but much more readable:"
    ],
    [
        "text",
        " "
    ],
    [
        "type",
        null
    ],
    [
        "text",
        " &nbsp;&nbsp;&nbsp;&nbsp;>>> [mktuple(i) for i in lst if over_ten(i)]"
    ],
    [
        "text",
        " &nbsp;&nbsp;&nbsp;&nbsp;[(12, 13, 14), (13, 14, 15), (14, 15, 16), (15, 16, 17), (16, 17, 18), (17, 18, 19), (18, 19,"
    ],
    [
        "text",
        " &nbsp;&nbsp;&nbsp;&nbsp;20), (19, 20, 21), (20, 21, 22)]"
    ],
    [
        "text",
        " "
    ],
    [
        "text",
        " "
    ],
    [
        "pause",
        "3"
    ],
    [
        "text",
        " "
    ],
    [
        "text",
        " "
    ],
    [
        "text",
        " "
    ],
    [
        "text",
        "   --- THE END ---"
    ],
    [
        "text",
        " "
    ],
    [
        "text",
        " "
    ]
];

(function($, name) {
/* jQuery typewriter plugin
    2012-11-15
    https://github.com/bergus */
    $[name+"Defaults"] = {
        framerate: 2500/60,
        group: /.{0,2}/g // 2: Number of chars per frame
    };
    $.fn[name] = function(options, callback) {
        if (typeof options != 'object') callback=options, options={};

        return this.each(function() {
            var el = $(this),
                conf = $.extend({}, $[name+"Defaults"], options);
            el.queue("fx", function(next) {
                animateNode(this, conf, typeof callback == 'function'
                  ? function() { callback.call(el[0]); next(); }
                  : next
                );
                el.show();
            });
        });
    };
    function chunk(text, conf) {
        // splitting the text into parts (http://stackoverflow.com/a/11657799/1048572)
        return text.match(conf.group);
    }
    function timeout(callback, conf) {
        // set up the timeout
        // want to randomize? Have a look at http://jsfiddle.net/pZb8W/2/ for possible implementation
        setTimeout(callback, conf.framerate);
    }
    function animateNode(element, conf, callback) {
        var pieces = [];
        if (element.nodeType==1 && element.hasChildNodes()) {
            while (element.hasChildNodes())
                pieces.push(element.removeChild(element.firstChild));
            (function childStep() {
                if (pieces.length) {
                    var piece = pieces.shift();
                    animateNode(piece, conf, childStep);
                    element.appendChild(piece);
                } else
                    callback();
            })();
        } else if (element.nodeType==3) {
            pieces = chunk(element.data, conf);
            element.data = "";
            (function addText(){
                element.data += pieces.shift();
                timeout(pieces.length ? addText : callback, conf);
            })();
        } else // empty or special (comment etc) node
            timeout(callback, conf);
    }

})(jQuery, "typewriter");


var $pause       = false;
var $type_effect = false;
var $index       = 0;
var $scrolldist  = 0;
var start_scroll = 15;

$(document).ready( function() {
    process_commands();
});


function process_commands() {
    if ($pause || $index >= commands.length) return;

    var command  = commands[$index][0];
    var arg      = commands[$index][1];
    var textarea = $("div#main");
    var timeout  = 500;
    var speed    = $("input#speed").val();

    if (!speed) speed = 1;
    speed = parseInt(speed);

    //if (speed < 1 || speed > 5) speed = 1;
    speed = 1 + (speed-1) / 4;
    // final max speed should be 2 at most.
    //$("span#progress").text($index + '/' + commands.length);
    $("span#progress").text(parseInt($index / commands.length * 100.0) + '%');
    $index++;

    if (command == "text") {
        var line = arg;
        if ($index >= start_scroll) {
            $scrolldist += 40;
            textarea.scrollTop($scrolldist);
        }

        eline = $("<span>" + line + "&nbsp;</span><br />").hide().appendTo(textarea);
        if ($type_effect) {
            eline.typewriter();
            timeout += (line.length * 40) / speed;

            // typewriter needs this to be shown fully
            $scrolldist += 40;
            textarea.scrollTop($scrolldist);
        } else {
            eline.show();
        }

        if (line.replace(/ /g, '') == '') $type_effect = false;

    } else if (command == "pause") {
        timeout = parseInt(arg, 10) * 1000;

    } else if (command == "type") {
        $type_effect = true;
    }

    if ($pause) {
        // avoid skipping scheduled command
        $index--;
        if ($index < 0) $index = 0;
    } else {
        setTimeout(process_commands, timeout / speed);
        //setTimeout(process_commands, timeout);
    }
}


function toggle_pause() {
    $("button").text($pause ? "Pause" : "Unpause")
    $pause = $pause ? false : true;
    if (!$pause) process_commands();
}

</script>
<style>
    * {
        font-family: Verdana, Arial, Sans-Serif;
        font-size: 14px;
    }

    div#main {
        background:#CCCCCC none repeat scroll 0 0;
        border:3px solid #666666;
        margin:5px;
        padding:5px;
        position:relative;
        width:900px;
        height:550px;
        overflow:auto;
    }

    button { margin-left: 100px; }
</style>
      <!-- p { margin:10px;padding:5px;border:2px solid #666; } -->
</head>

<body>
    <button onClick="toggle_pause()">Pause</button>
    Speed (1-5): <input id="speed" type="text" name="speed" value="1" size="3" />
    <span id="progress"></span>

    <div id="main"></div>
</body>
</html>
